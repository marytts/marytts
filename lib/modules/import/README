#
 # Copyright 2007 DFKI GmbH.
 # All Rights Reserved.  Use is subject to license terms.
 # 
 # Permission is hereby granted, free of charge, to use and distribute
 # this software and its documentation without restriction, including
 # without limitation the rights to use, copy, modify, merge, publish,
 # distribute, sublicense, and/or sell copies of this work, and to
 # permit persons to whom this work is furnished to do so, subject to
 # the following conditions:
 # 
 # 1. The code must retain the above copyright notice, this list of
 #    conditions and the following disclaimer.
 # 2. Any modifications must be clearly marked as such.
 # 3. Original authors' names are not deleted.
 # 4. The authors' names are not used to endorse or promote products
 #    derived from this software without specific prior written
 #    permission.
 #
 # DFKI GMBH AND THE CONTRIBUTORS TO THIS WORK DISCLAIM ALL WARRANTIES WITH
 # REGARD TO THIS SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF
 # MERCHANTABILITY AND FITNESS, IN NO EVENT SHALL DFKI GMBH NOR THE
 # CONTRIBUTORS BE LIABLE FOR ANY SPECIAL, INDIRECT OR CONSEQUENTIAL
 # DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
 # PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS
 # ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
 # THIS SOFTWARE.
 #
 # Author: Anna Hunecke
 # July 17th, 2007
 #
 
Importing voices into MARY

This README explains the steps necessary to import your voice into MARY.

1. What do you need for a voice?
- wave files: the wave files should be all in one directory
- transcript files: either you have a transcript file in the Festvox format 
					or each sentence is in its own file and the files are all in
					one directory
- label files: label files have to be in Festvox format. If you do not have labels yet, you can
					use the autolabeling modules of the voice import tool

2. What programs do you need to import a voice into MARY?
- praat: is needed to compute the pitchmarks. You can download praat here: http://www.fon.hum.uva.nl/praat/
- Edinburgh Speech Tools: are needed to compute MelCepstrum Coefficients and to build duration, f0 and 
											preselection trees. You can download them from here:
											http://www.cstr.ed.ac.uk/projects/speech_tools/
- Sphinx2 and SphinxTrain: are used for autolabelling. If you already have labels, you do not need them.
											Download link: http://cmusphinx.sourceforge.net/html/cmusphinx.php

3. How does the import work?
For the actual import, you can use the import tool that comes with MARY. Start the import tool in the directory 
where you want to store your voice data. The easiest way to start the tool is to call Java from the command line:

For Linux/Unix/Mac OS X:
export MARY_BASE="/path/to/mary"
java -Xmx1024m -classpath $MARY_BASE/java/mary-common.jar:$MARY_BASE/java/signalproc.jar:
$MARY_BASE/java/maryclient.jar:$MARY_BASE/java/jsresources.jar:$MARY_BASE/java/log4j-1.2.8.jar
-Djava.endorsed.dirs=$MARY_BASE/lib/endorsed
de.dfki.lt.mary.unitselection.voiceimport.DatabaseImportMain 

For Windows:
set MARY_BASE="/path/to/mary"
java -Xmx512m -classpath %MARY_BASE%\java\mary-common.jar;%MARY_BASE%\java\signalproc.jar;
%MARY_BASE%\java\maryclient.jar;%MARY_BASE%\java\jsresources.jar;%MARY_BASE%\java\log4j-1.2.8.jar
-Djava.endorsed.dirs=%MARY_BASE%\lib\endorsed
de.dfki.lt.mary.unitselection.voiceimport.DatabaseImportMain


When starting the voice import tool for the first time, you are presented with a GUI window where you 
have to enter a few basic settings. Almost all other settings are based on these first settings and set automatically.
After clicking the "Save"-button, you get to the main window. There you can see a list of modules. A component is
executed by ticking the associated checkbox and clicking on "Run". 
You can change the settings for each component by clicking on the wrench symbol next to the component. 
Clicking on "Settings" takes you to the window where you can change the basic settings. 
In a settings window, you can change the view to the settings of another module or the basic settings via the 
drop-down menu. 
Basically, all modules need to be run to import the voice into MARY. For more detailed information, check the
general help file - just click on "Help" in the main window. Clicking on help in the settings window opens a help
window with details about the displayed settings. 

The import tool creates two files in the directory where you started it - database.config and importMain.config.
database.config contains the values of the settings - you can change the settings also in this file, but be aware that 
this may cause problems. 
importMain.config contains the list of modules that are displayed in the main window. If you want to use the
autolabeling with Sphinx, uncomment the lines were the Sphinx modules are called and re-start the voice import
tool.

You can use the last module - VoiceInstaller - to install your voice. Now, next time you start the MARY server, 
the new voice is loaded.

4. What fine-tuning can you do afterwards?
If you are not quite happy with the sound of your voice, one thing you can do is to tune the weights for target and
join cost. Look in the directory where your voice is installed, usually MARYBASE/lib/voices/<voicename>. There 
you will find the files defining the weights: halfphoneUnitFeatureDefinition_ac.txt for the target cost
and joinCostWeights.txt for the join cost.